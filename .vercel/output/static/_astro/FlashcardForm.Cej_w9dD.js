import{j as e,B as y}from"./button.W_Ymsyb6.js";import{r as f,R as v}from"./index.ai7qpRr1.js";import{L as j}from"./LoadingSpinner.RGo8tKwc.js";function L({flashcard:s,onSave:m,onCancel:h,mode:o="create"}){const[i,w]=f.useState(s||null),[g,x]=f.useState(o==="edit"&&!s),[r,b]=f.useState({front:(s||i)?.front||"",back:(s||i)?.back||""}),[n,p]=f.useState(!1),[d,l]=f.useState(null);v.useEffect(()=>{if(o==="edit"&&!s&&!i){const t=document.querySelector("[data-flashcard-id]")?.getAttribute("data-flashcard-id");t&&k(t)}},[o,s,i]);const k=async t=>{try{x(!0);const a=await fetch(`/api/flashcards/${t}`);if(!a.ok){if(a.status===404){l("Fiszka nie została znaleziona");return}throw new Error("Failed to load flashcard")}const c=await a.json();w(c),b({front:c.front,back:c.back})}catch{l("Nie udało się załadować fiszki")}finally{x(!1)}},z=async t=>{if(t.preventDefault(),!r.front.trim()||!r.back.trim()){l("Proszę wypełnić oba pola");return}p(!0),l(null);try{let a;if(o==="edit"&&(s||i)){const u=s||i;if(!u)throw new Error("No flashcard data available");a=await fetch(`/api/flashcards/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}else a=await fetch("/api/flashcards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok){const u=await a.json();throw new Error(u.message||"Nie udało się zapisać fiszki")}const c=await a.json();m?m(c):window.location.href="/flashcards"}catch(a){l(a instanceof Error?a.message:"Wystąpił błąd podczas zapisywania")}finally{p(!1)}},N=()=>{h?h():window.location.href="/flashcards"};return g?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(j,{text:"Ładowanie fiszki..."})}):e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"text-red-800",children:[e.jsx("strong",{children:"Błąd:"})," ",d]}),d==="Fiszka nie została znaleziona"&&e.jsx("a",{href:"/flashcards",className:"mt-2 inline-block bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded",children:"Powrót do listy"})]}),d&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-md p-3 mb-4",children:e.jsxs("p",{className:"text-sm",children:["Błąd: ",d]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"front",className:"block text-sm font-medium text-gray-700 mb-2","data-testid":"front-label",children:"Przód fiszki *"}),e.jsx("textarea",{id:"front","data-testid":"front-textarea",value:r.front,onChange:t=>b(a=>({...a,front:t.target.value})),placeholder:"Wprowadź pytanie lub pojęcie...",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[100px] resize-y",disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"back",className:"block text-sm font-medium text-gray-700 mb-2","data-testid":"back-label",children:"Tył fiszki *"}),e.jsx("textarea",{id:"back","data-testid":"back-textarea",value:r.back,onChange:t=>b(a=>({...a,back:t.target.value})),placeholder:"Wprowadź odpowiedź lub wyjaśnienie...",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[100px] resize-y",disabled:n})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(y,{type:"submit","data-testid":"submit-button",disabled:n||!r.front.trim()||!r.back.trim(),className:"flex-1 sm:flex-none",children:n?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{size:"sm",color:"white"}),e.jsx("span",{children:"Zapisywanie..."})]}):o==="edit"?"Zaktualizuj fiszkę":"Utwórz fiszkę"}),e.jsx(y,{type:"button",variant:"outline",onClick:N,disabled:n,"data-testid":"cancel-button",children:"Anuluj"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"* Pola wymagane"})]})}export{L as FlashcardForm};
