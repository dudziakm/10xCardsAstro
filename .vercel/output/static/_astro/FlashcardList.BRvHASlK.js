import{j as e,B as l}from"./button.W_Ymsyb6.js";import{r as x,R as D}from"./index.ai7qpRr1.js";import{L as M}from"./LoadingSpinner.RGo8tKwc.js";function A({flashcard:t,onEdit:r,onDelete:u,onView:f,showActions:p=!0,"data-testid":d}){const m=a=>new Date(a).toLocaleDateString("pl-PL",{day:"numeric",month:"short",year:"numeric"}),o=(a,i)=>a.length>i?a.substring(0,i)+"...":a;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow flex flex-col h-full","data-testid":d,children:[e.jsx("div",{className:"flex justify-between items-start mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.source==="ai"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:t.source==="ai"?"AI":"Manual"}),e.jsx("span",{className:"text-xs text-gray-500",children:t.updated_at!==t.created_at?`Edytowano: ${m(t.updated_at)}`:`Utworzono: ${m(t.created_at)}`})]})}),e.jsxs("div",{className:"space-y-4 mb-4 flex-1",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 border-l-4 border-blue-400",children:[e.jsx("div",{className:"flex items-center mb-2",children:e.jsx("span",{className:"text-blue-600 text-sm font-semibold",children:"📄 Przód"})}),e.jsx("div",{className:"text-gray-900 text-sm leading-relaxed",title:t.front,children:o(t.front,100)})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border-l-4 border-green-400",children:[e.jsx("div",{className:"flex items-center mb-2",children:e.jsx("span",{className:"text-green-600 text-sm font-semibold",children:"📝 Tył"})}),e.jsx("div",{className:"text-gray-800 text-sm leading-relaxed",title:t.back,children:o(t.back,150)})]})]}),p&&e.jsxs("div",{className:"flex justify-end space-x-2 pt-3 border-t border-gray-100",children:[f&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>f(t.id),className:"text-blue-600 border-blue-300 hover:bg-blue-50 hover:text-blue-700 hover:border-blue-400","data-testid":"view-flashcard",children:"👁️ Podgląd"}),r&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>r(t.id),className:"text-amber-600 border-amber-300 hover:bg-amber-50 hover:text-amber-700 hover:border-amber-400","data-testid":"edit-flashcard",children:"✏️ Edytuj"}),u&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(t.id),className:"text-red-600 border-red-300 hover:bg-red-50 hover:text-red-700 hover:border-red-400","data-testid":"delete-flashcard",children:"🗑️ Usuń"})]})]})}function B({value:t,onSearch:r,placeholder:u="Szukaj...",className:f="","data-testid":p}){const[d,m]=x.useState(t),o=i=>{i.preventDefault(),r(d)},a=()=>{m(""),r("")};return e.jsx("form",{onSubmit:o,className:`relative ${f}`,"data-testid":p,children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:d,onChange:i=>m(i.target.value),placeholder:u,className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500","data-testid":"search-input"}),d&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-gray-600 focus:outline-none",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]})})}function I({currentPage:t,totalPages:r,onPageChange:u,showSummary:f=!0,className:p=""}){if(r<=1)return null;const m=(()=>{const a=[],i=[];for(let g=Math.max(2,t-2);g<=Math.min(r-1,t+2);g++)a.push(g);return t-2>2?i.push(1,"..."):i.push(1),i.push(...a),t+2<r-1?i.push("...",r):r>1&&i.push(r),i})();return e.jsxs("div",{className:`flex items-center justify-between ${p}`,children:[f&&e.jsxs("div",{className:"text-sm text-gray-700",children:["Strona ",e.jsx("span",{className:"font-medium",children:t})," z ",e.jsx("span",{className:"font-medium",children:r})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(t-1),disabled:t<=1,children:"Poprzednia"}),e.jsx("div",{className:"flex items-center space-x-1",children:m.map((o,a)=>e.jsx(D.Fragment,{children:o==="..."?e.jsx("span",{className:"px-3 py-2 text-gray-500",children:"..."}):e.jsx(l,{variant:o===t?"default":"outline",size:"sm",onClick:()=>u(o),className:"min-w-[2.5rem]",children:o})},a))}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>u(t+1),disabled:t>=r,children:"Następna"})]})]})}function W({onEdit:t,onDelete:r,onView:u,onCreateNew:f,onGenerateAI:p}={}){const d={onEdit:t||(s=>window.location.href=`/flashcards/${s}/edit`),onView:u||(s=>window.location.href=`/flashcards/${s}`),onCreateNew:f||(()=>window.location.href="/flashcards/new"),onGenerateAI:p||(()=>window.location.href="/generate")},[m,o]=x.useState([]),[a,i]=x.useState({current_page:1,total_pages:1,total_items:0,items_per_page:10}),[g,y]=x.useState(!0),[k,z]=x.useState(null),[h,S]=x.useState(""),[c,E]=x.useState(()=>{if(typeof window<"u"){const n=new URLSearchParams(window.location.search).get("filter");if(n==="manual"||n==="ai"||n==="all")return n}return"all"}),j=x.useCallback(async(s=1,n=h,v=c)=>{try{y(!0),z(null);const b=new URLSearchParams({page:s.toString(),limit:"10",sort:"updated_at",order:"desc"});n.trim()&&b.append("search",n.trim()),v!=="all"&&b.append("source",v);const N=await fetch(`/api/flashcards?${b.toString()}`);if(!N.ok){const $=await N.json();throw new Error($.message||"Failed to fetch flashcards")}const C=await N.json();o(C.data),i(C.pagination)}catch(b){z(b instanceof Error?b.message:"An error occurred")}finally{y(!1)}},[h,c]);x.useEffect(()=>{j()},[j]);const _=s=>{S(s),j(1,s,c)},w=s=>{E(s),j(1,h,s)},L=s=>{j(s,h,c)},F=async s=>{if(confirm("Czy na pewno chcesz usunąć tę fiszkę?"))try{const n=await fetch(`/api/flashcards/${s}`,{method:"DELETE"});if(!n.ok){const v=await n.json();throw new Error(v.message||"Failed to delete flashcard")}j(a.current_page,h,c)}catch(n){alert(n instanceof Error?n.message:"Failed to delete flashcard")}};return g?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(M,{})}):k?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"text-red-800",children:[e.jsx("strong",{children:"Błąd:"})," ",k]}),e.jsx(l,{onClick:()=>j(),className:"mt-2",variant:"outline",children:"Spróbuj ponownie"})]}):e.jsxs("div",{className:"space-y-6","data-testid":"flashcards-list",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Moje fiszki"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(l,{onClick:d.onCreateNew,"data-testid":"create-flashcard",children:"Dodaj fiszkę"}),e.jsx(l,{onClick:d.onGenerateAI,variant:"outline","data-testid":"generate-ai-button",children:"Generuj AI"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(B,{value:h,onSearch:_,placeholder:"Szukaj w fiszkach...","data-testid":"search-bar"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:c==="all"?"default":"outline",size:"sm",onClick:()=>w("all"),"data-testid":"filter-all",children:"Wszystkie"}),e.jsx(l,{variant:c==="manual"?"default":"outline",size:"sm",onClick:()=>w("manual"),"data-testid":"filter-manual",children:"Manualne"}),e.jsx(l,{variant:c==="ai"?"default":"outline",size:"sm",onClick:()=>w("ai"),"data-testid":"filter-ai",children:"AI"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Znaleziono ",a.total_items," fiszek",h&&` dla zapytania "${h}"`,c!=="all"&&` (${c})`]}),m.length===0?e.jsxs("div",{className:"text-center py-12","data-testid":"empty-state",children:[e.jsx("div",{className:"text-gray-500 mb-4",children:h||c!=="all"?"Nie znaleziono fiszek pasujących do kryteriów wyszukiwania.":"Nie masz jeszcze żadnych fiszek."}),!h&&c==="all"&&e.jsx(l,{onClick:d.onCreateNew,"data-testid":"create-first-flashcard",children:"Utwórz swoją pierwszą fiszkę"})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m.map(s=>e.jsx(A,{flashcard:s,onEdit:d.onEdit,onDelete:r||F,onView:d.onView,"data-testid":"flashcard-item"},s.id))}),a.total_pages>1&&e.jsx(I,{currentPage:a.current_page,totalPages:a.total_pages,onPageChange:L})]})}export{W as FlashcardList};
