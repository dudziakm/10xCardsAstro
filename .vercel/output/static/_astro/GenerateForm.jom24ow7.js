import{j as e,B as z}from"./button.W_Ymsyb6.js";import{r as c}from"./index.ai7qpRr1.js";import{L as P}from"./LoadingSpinner.RGo8tKwc.js";function A({candidates:m,generationId:g,onAccept:h,onCancel:j,isLoading:a=!1}){const[u,r]=c.useState(new Set),b=t=>{const s=new Set(u);s.has(t)?s.delete(t):s.add(t),r(s)},f=()=>{r(new Set(m.map((t,s)=>s)))},o=()=>{r(new Set)},y=async()=>{const t=m.filter((s,d)=>u.has(d));if(t.length===0){alert("Musisz wybraÄ‡ co najmniej jednÄ… fiszkÄ™");return}await h(g,t)},n=u.size,p=m.length;return e.jsx("div",{className:"max-w-4xl mx-auto p-6","data-testid":"generated-flashcards",children:e.jsxs("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Przejrzyj wygenerowane fiszki"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Wybierz fiszki, ktÃ³re chcesz dodaÄ‡ do swojej kolekcji (",n,"/",p," wybrane)"]})]}),e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:f,"data-testid":"select-all-button",className:"text-sm text-blue-600 hover:text-blue-700 font-medium",disabled:a,children:"Zaznacz wszystkie"}),e.jsx("button",{onClick:o,"data-testid":"select-none-button",className:"text-sm text-gray-600 hover:text-gray-700 font-medium",disabled:a,children:"Odznacz wszystkie"}),e.jsxs("span",{className:"text-sm text-gray-500 ml-auto",children:[n," z ",p," fiszek wybranych"]})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:m.map((t,s)=>e.jsx("div",{"data-testid":`candidate-card-${s}`,className:`p-6 cursor-pointer transition-colors ${u.has(s)?"bg-blue-50 border-l-4 border-l-blue-500":"hover:bg-gray-50"}`,onClick:()=>!a&&b(s),onKeyDown:d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),a||b(s))},role:"button",tabIndex:0,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("input",{type:"checkbox","data-testid":`candidate-checkbox-${s}`,checked:u.has(s),onChange:()=>b(s),className:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",disabled:a}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"PrzÃ³d fiszki"}),e.jsx("p",{className:"text-sm text-gray-700 bg-white p-3 rounded border",children:t.front})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"TyÅ‚ fiszki"}),e.jsx("p",{className:"text-sm text-gray-700 bg-white p-3 rounded border",children:t.back})]})]}),t.difficulty&&e.jsx("div",{className:"mt-3",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:["TrudnoÅ›Ä‡: ",t.difficulty,"/5"]})})]})]})},s))}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:n>0&&e.jsxs(e.Fragment,{children:["Dodasz ",n," ",n===1?"fiszkÄ™":"fiszek"," do swojej kolekcji"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:j,disabled:a,"data-testid":"cancel-review-button",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Anuluj"}),e.jsx("button",{onClick:y,disabled:a||n===0,"data-testid":"accept-candidates-button",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Dodawanie...":`Dodaj wybrane (${n})`})]})]})]})})}function I({onGenerated:m,onCancel:g}){const[h,j]=c.useState(""),[a,u]=c.useState(5),[r,b]=c.useState(!1),[f,o]=c.useState(null),[y,n]=c.useState(null),[p,t]=c.useState(null),[s,d]=c.useState(!1),k=async x=>{if(x.preventDefault(),!h.trim()){o("ProszÄ™ wprowadziÄ‡ temat do wygenerowania fiszek");return}b(!0),o(null);try{const l=await fetch("/api/flashcards/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:h.trim(),count:a})});if(!l.ok){const w=await l.json();throw new Error(w.message||"Nie udaÅ‚o siÄ™ wygenerowaÄ‡ fiszek")}const i=await l.json();n(i.candidates),t(i.generation_id)}catch(l){o(l instanceof Error?l.message:"WystÄ…piÅ‚ bÅ‚Ä…d podczas generowania")}finally{b(!1)}},v=async(x,l)=>{d(!0),o(null);try{const i=await fetch("/api/flashcards/accept",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({generation_id:x,accepted_candidates:l})});if(!i.ok){const S=await i.json();throw new Error(S.error||"Nie udaÅ‚o siÄ™ zaakceptowaÄ‡ fiszek")}const w=await i.json();m?m(w.flashcards):window.location.href="/flashcards"}catch(i){o(i instanceof Error?i.message:"WystÄ…piÅ‚ bÅ‚Ä…d podczas akceptowania fiszek")}finally{d(!1)}},N=()=>{n(null),t(null),o(null)},C=()=>{g?g():window.location.href="/flashcards"};return y&&p?e.jsxs("div",{children:[f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"text-red-800",children:[e.jsx("strong",{children:"BÅ‚Ä…d:"})," ",f]})}),e.jsx(A,{candidates:y,generationId:p,onAccept:v,onCancel:N,isLoading:s})]}):e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-red-800",children:[e.jsx("strong",{children:"BÅ‚Ä…d:"})," ",f]})}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-blue-800",children:[e.jsx("strong",{children:"ðŸ¤– Generowanie AI:"})," Podaj temat, a AI wygeneruje dla Ciebie fiszki do nauki."]})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"prompt",className:"block text-sm font-medium text-gray-700 mb-2","data-testid":"prompt-label",children:"Temat do nauki *"}),e.jsx("textarea",{id:"prompt","data-testid":"prompt-textarea",value:h,onChange:x=>j(x.target.value),placeholder:"Np. podstawy programowania w JavaScript, historia Polski w XX wieku, wzory matematyczne...",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[100px] resize-y",disabled:r}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:"Opisz szczegÃ³Å‚owo czego chcesz siÄ™ nauczyÄ‡. Im bardziej konkretny opis, tym lepsze fiszki."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"count",className:"block text-sm font-medium text-gray-700 mb-2","data-testid":"count-label",children:"Liczba fiszek do wygenerowania"}),e.jsxs("select",{id:"count","data-testid":"count-select",value:a,onChange:x=>u(parseInt(x.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:r,children:[e.jsx("option",{value:3,children:"3 fiszki"}),e.jsx("option",{value:5,children:"5 fiszek"}),e.jsx("option",{value:10,children:"10 fiszek"}),e.jsx("option",{value:15,children:"15 fiszek"}),e.jsx("option",{value:20,children:"20 fiszek"})]}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:"Rekomendujemy zaczÄ…Ä‡ od mniejszej liczby, aby sprawdziÄ‡ jakoÅ›Ä‡ generowanych fiszek."})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(z,{type:"submit",disabled:r||!h.trim(),className:"flex-1 sm:flex-none","data-testid":"generate-button",children:r?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(P,{size:"sm",color:"white"}),e.jsx("span",{children:"GenerujÄ™ fiszki..."})]}):`Wygeneruj ${a} fiszek`}),e.jsx(z,{type:"button",variant:"outline",onClick:C,disabled:r,"data-testid":"cancel-button",children:"Anuluj"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"* Pola wymagane"}),r&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"text-yellow-800",children:[e.jsx("strong",{children:"Generowanie w toku..."})," To moÅ¼e potrwaÄ‡ kilka sekund. ProszÄ™ czekaÄ‡."]})})]})}export{I as GenerateForm};
