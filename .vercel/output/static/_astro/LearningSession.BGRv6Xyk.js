import{j as e,B as m}from"./button.W_Ymsyb6.js";import{r}from"./index.ai7qpRr1.js";import{L as k}from"./LoadingSpinner.RGo8tKwc.js";function S({card:i,onRate:d,isLoading:j=!1}){const[s,u]=r.useState(!1),[t,h]=r.useState(!1);r.useEffect(()=>{u(!1),h(!1)},[i.id]);const p=a=>{h(!0),d(a)},l=()=>{t||u(!0)},f=a=>({1:"Nie pamiętam",2:"Słabo",3:"Przeciętnie",4:"Dobrze",5:"Bardzo dobrze"})[a],o=a=>({1:"bg-red-500 hover:bg-red-600",2:"bg-orange-500 hover:bg-orange-600",3:"bg-yellow-500 hover:bg-yellow-600",4:"bg-green-500 hover:bg-green-600",5:"bg-emerald-500 hover:bg-emerald-600"})[a];return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("div",{className:`relative bg-white border-2 border-gray-200 rounded-xl shadow-lg transition-all duration-300 ${!s&&!t?"cursor-pointer hover:scale-105":""}`,style:{minHeight:"400px"},onClick:l,"data-testid":"learning-card",onKeyDown:a=>{!s&&!t&&(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),l())},role:!s&&!t?"button":void 0,tabIndex:!s&&!t?0:void 0,"aria-label":!s&&!t?"Kliknij aby zobaczyć odpowiedź":void 0,children:e.jsxs("div",{className:"absolute inset-0 p-8 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:`px-4 py-2 rounded-full text-sm font-medium ${s?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s?"Odpowiedź":"Pytanie"}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[i.review_count>0&&e.jsxs("div",{children:["Przeglądy: ",i.review_count]}),i.last_reviewed&&e.jsxs("div",{children:["Ostatnio: ",new Date(i.last_reviewed).toLocaleDateString("pl-PL")]}),e.jsxs("div",{children:["Trudność: ",i.difficulty_rating.toFixed(1),"/5.0"]})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-xl leading-relaxed mb-4","data-testid":s?"card-back":"card-front",children:s?i.back:i.front})})}),e.jsxs("div",{className:"text-center mt-6",children:[!s&&!t&&e.jsx("p",{className:"text-gray-600",children:"Kliknij aby zobaczyć odpowiedź"}),s&&!t&&e.jsx("p",{className:"text-gray-600",children:"Oceń jak dobrze pamiętałeś odpowiedź"}),t&&e.jsx("p",{className:"text-green-600 font-medium",children:"✓ Oceniono! Ładowanie następnej fiszki..."})]})]})}),s&&!t&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("div",{className:"text-center text-gray-700 font-medium",children:"Jak dobrze pamiętałeś odpowiedź?"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-5 gap-2",children:[1,2,3,4,5].map(a=>e.jsxs(m,{onClick:()=>p(a),disabled:j,className:`${o(a)} text-white border-0 py-4 px-3 text-sm h-auto min-h-[60px] flex flex-col items-center justify-center`,"data-testid":`rating-${a}`,children:[e.jsx("div",{className:"font-bold text-lg leading-tight",children:a}),e.jsx("div",{className:"text-xs leading-tight mt-1 whitespace-normal text-center",children:f(a)})]},a))}),e.jsxs("div",{className:"text-xs text-gray-500 text-center space-y-1",children:[e.jsx("div",{children:"1 = Następny przegląd za 1 dzień"}),e.jsx("div",{children:"2 = za 2 dni | 3 = za 4 dni | 4 = za 7 dni | 5 = za 14 dni"})]})]}),j&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 text-gray-600",children:[e.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full"}),e.jsx("span",{children:"Zapisywanie oceny..."})]})})]})}function R({onEnd:i}){const[d,j]=r.useState(null),[s,u]=r.useState(null),[t,h]=r.useState(!0),[p,l]=r.useState(!1),[f,o]=r.useState(null),[a,v]=r.useState(!1);r.useEffect(()=>{g()},[]);const g=async c=>{try{h(!0),o(null);const n=new URL("/api/learn/session",window.location.origin);c&&n.searchParams.set("session_id",c);const x=await fetch(n.toString());if(!x.ok){const z=await x.json();throw new Error(z.message||"Failed to load learning session")}const w=await x.json();j(w.card),u(w.session),w.card||v(!0)}catch(n){o(n instanceof Error?n.message:"An error occurred")}finally{h(!1)}},N=async c=>{if(!(!d||!s))try{l(!0),o(null);const n=await fetch("/api/learn/session/rate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:s.session_id,flashcard_id:d.id,rating:c})});if(!n.ok){const x=await n.json();throw new Error(x.message||"Failed to rate flashcard")}setTimeout(()=>{g(s.session_id),l(!1)},1500)}catch(n){o(n instanceof Error?n.message:"Failed to rate flashcard"),l(!1)}},b=async()=>{i?i():window.location.href="/flashcards"},y=()=>{if(!s)return"";const c=new Date(s.session_start);return`${Math.round((new Date().getTime()-c.getTime())/(1e3*60))} min`};return t&&!d?e.jsx("div",{className:"flex justify-center items-center min-h-[400px]",children:e.jsx(k,{text:"Ładowanie sesji nauki..."})}):f?e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsxs("div",{className:"text-red-800 mb-4",children:[e.jsx("strong",{children:"Błąd:"})," ",f]}),e.jsxs("div",{className:"space-x-3",children:[e.jsx(m,{onClick:()=>g(),variant:"outline",children:"Spróbuj ponownie"}),e.jsx(m,{onClick:b,variant:"outline",children:"Zakończ sesję"})]})]})}):a||!d?e.jsx("div",{className:"max-w-2xl mx-auto text-center",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🎉"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-4",children:"Sesja nauki zakończona!"}),s&&e.jsxs("div",{className:"text-green-700 mb-6 space-y-2",children:[e.jsxs("div",{children:["Przejrzano fiszek: ",e.jsx("strong",{children:s.cards_reviewed})]}),e.jsxs("div",{children:["Czas sesji: ",e.jsx("strong",{children:y()})]}),e.jsx("div",{className:"text-sm text-green-600",children:s.message||"Wszystkie dostępne fiszki zostały przejrzane"})]}),e.jsxs("div",{className:"space-x-3",children:[e.jsx(m,{onClick:()=>g(),children:"Rozpocznij nową sesję"}),e.jsx(m,{onClick:b,variant:"outline",children:"Powrót do fiszek"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[s&&e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Przejrzano:"})," ",s.cards_reviewed]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pozostało:"})," ",s.cards_remaining]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Czas:"})," ",y()]})]}),e.jsx(m,{onClick:b,variant:"outline",size:"sm",children:"Zakończ sesję"})]})})}),e.jsx(S,{card:d,onRate:N,isLoading:p})]})}export{R as LearningSession};
